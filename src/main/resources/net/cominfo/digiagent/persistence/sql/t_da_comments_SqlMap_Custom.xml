<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="t_da_comments_Custom" >
  <select id="pageByCondition" parameterClass="net.cominfo.digiagent.utils.Page"
		resultClass="HashMap">
		select 
			t_da_user.user_name username, 
			t_da_comments.comment_content content,  
			date_format(t_da_comments.created_date, '%Y/%m/%d %H:%i:%s') as createdDate
		from 
			t_da_comments,t_da_user 
		where
			t_da_comments.user_id = t_da_user.user_id 
		and 
			t_da_comments.supplier_id = $param.supplierId$
		order by 
			t_da_comments.created_date desc
		LIMIT $first$, $pageSize$;
	</select>
	
	<select id="sumBySupplierID" parameterClass="int" resultClass="long">
		select (t1.score + t2.score) score FROM
		( 
			select 
				(case (SUPPLIER_CERTIFY is not null) WHEN 0 then 0 ELSE  500 end ) +
				(case (SUPPLIER_QUALIFY is not null) WHEN 0 then 0 ELSE  500 end ) SCORE
			from t_da_supplier where SUPPLIER_ID = #value# 
		) t1,
		(
			select 
				case (t.score is not NULL) when 1 then sum(t.score) ELSE 0 end SCORE
			from
			(
				SELECT 
			    	case comment_rank 
			        	when '0' then 0
			        	when '1' then 1
			        	when '2' then 2
			        	when '3' then 3
			        	when '4' then 4
			        	when '5' then 5
			        	when '6' then 6
				        when '7' then 7
				        when '8' then 8
				        when '9' then 9
				        when 'A' then 10
				        else  0
				    end score
				FROM t_da_comments where supplier_id = #value#
			) t
		) t2
	</select>
</sqlMap>