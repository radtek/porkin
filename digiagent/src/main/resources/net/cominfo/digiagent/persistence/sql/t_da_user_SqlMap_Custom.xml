<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="t_da_user_Custom">
	<select id="pageByCondition" parameterClass="net.cominfo.digiagent.utils.Page"
		resultClass="HashMap">
		SELECT
		       t_da_user.user_id as userId,
		       user_name as userName,
		       user_password as userPassword,
		       user_email as userEmail,
		       date_format(lastlogintime, '%Y/%m/%d %H:%i:%s') as lastlogintime,
		       date_format(registertime, '%Y/%m/%d %H:%i:%s') as registertime,
		       logonsum as logonsum,
		       t_da_user.active_flag as activeFlag,
		       t_da_user.created_by as createdBy,
		       date_format(t_da_user.created_date, '%Y/%m/%d %H:%i:%s') as createdDate,
		       t_da_user.lastupdated_by as lastupdatedBy,
		       date_format(t_da_user.lastupdated_date, '%Y/%m/%d %H:%i:%s') as lastupdatedDate,
		       t_da_role.role_name as roleName
		  FROM t_da_user
		  LEFT JOIN t_da_userrole ON t_da_user.user_id = t_da_userrole.user_id
		  LEFT JOIN t_da_role ON t_da_userrole.role_id = t_da_role.role_id
		 WHERE t_da_user.user_id > 0
		 <isNotEmpty prepend="AND" property="param.userName">
			user_name like '%$param.userName$%'
         </isNotEmpty>
		 <isNotEmpty prepend="ORDER BY" property="orderByStatement">
		 	$orderByStatement$
		 </isNotEmpty>
		 LIMIT $first$, $pageSize$;
	</select>
	
	<select id="countByCondition" parameterClass="net.cominfo.digiagent.utils.Page"
		resultClass="HashMap">
		SELECT count(*) as total
		FROM t_da_user
		  LEFT JOIN t_da_userrole ON t_da_user.user_id = t_da_userrole.user_id
		  LEFT JOIN t_da_role ON t_da_userrole.role_id = t_da_role.role_id
		 WHERE t_da_user.user_id > 0
		 <isNotEmpty prepend="AND" property="param.userName">
			user_name = '%$param.userName$%'
		</isNotEmpty>
	</select>

	<select id="listByCondition" parameterClass="HashMap"
		resultClass="HashMap">
		SELECT * FROM t_da_user WHERE user_id > 0
		<isNotEmpty prepend="AND" property="userName">
			user_name = '$userName$'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="userId">
			user_id != $userId$
		</isNotEmpty>
	</select>
	
	<select id="getUserInfo" resultClass="HashMap" parameterClass="HashMap">
		SELECT 
			t_da_user.user_id as userId,
	        user_name as userName,
	        user_password as userPassword,
	        user_email as userEmail,
	        date_format(lastlogintime, '%Y/%m/%d %H:%i:%s') as lastlogintime,
	        date_format(registertime, '%Y/%m/%d %H:%i:%s') as registertime,
	        logonsum as logonsum,
	        t_da_user.active_flag as activeFlag,
	        t_da_user.created_by as createdBy,
	        date_format(t_da_user.created_date, '%Y/%m/%d %H:%i:%s') as createdDate,
	        t_da_user.lastupdated_by as lastupdatedBy,
	        date_format(t_da_user.lastupdated_date, '%Y/%m/%d %H:%i:%s') as lastupdatedDate,
	        t_da_role.role_name as roleName,
			t_da_userrole.role_id as roleId
		FROM t_da_user
		  LEFT JOIN t_da_userrole ON t_da_user.user_id = t_da_userrole.user_id
		  LEFT JOIN t_da_role ON t_da_userrole.role_id = t_da_role.role_id
		 WHERE t_da_user.user_id > 0
		 <isNotEmpty prepend="AND" property="userId">
			t_da_user.user_id = $userId$
		</isNotEmpty>
	</select>
</sqlMap>