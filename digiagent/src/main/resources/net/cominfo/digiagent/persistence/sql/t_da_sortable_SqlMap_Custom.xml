<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="t_da_sortable_Custom">

	<parameterMap id="getAllIdParameters" class="map">
		<parameter property="IN_ID" jdbcType="int" javaType="java.lang.Integer" mode="IN" />
  		<parameter property="OUT_IDS" jdbcType="string" javaType="java.lang.String" mode="OUT" />
 	</parameterMap>
 	
 	 <procedure id="getSortableChildIds" parameterMap="getAllIdParameters">
  		{CALL GET_SORTABLE_CHILD(?,?)}
 	</procedure>

	<delete id="batchdeleteByPrimaryKey" parameterClass="List">
		delete from t_da_sortable
		<dynamic prepend="WHERE SORTABLE_ID IN ">
			<iterate open="(" close=")" conjunction=","> #[]# </iterate>
		</dynamic>
	</delete>
	
	<delete id="cleanSortableTable">
		TRUNCATE TABLE t_da_sortable; 
	</delete>
	
	<select id="getPageDisplay" parameterClass="List" resultClass="HashMap">
		SELECT 
			t_da_category.CATEGORY_ID as CATEGORY_ID,
			t_da_category.CATEGORY_NAME as CATEGORY_NAME,
			t_da_product.PRODUCT_ID  as PRODUCT_ID,
			t_da_product.PRODUCT_NAME as PRODUCT_NAME,
			t_da_brand.BRAND_ID as BRAND_ID,
			t_da_brand.BRAND_NAME as BRAND_NAME
		from 
			(select 
				t1.SORTABLE_KEY category_id, 
				t2.SORTABLE_KEY product_id,
				t3.SORTABLE_KEY brand_id
			from t_da_sortable t1
			LEFT JOIN t_da_sortable t2 on(t1.SORTABLE_ID = t2.PARENT_ID)
			left join t_da_sortable t3 on (t2.SORTABLE_ID = t3.PARENT_ID)
			where t1.SORTABLE_TYPE = 'C'
			ORDER BY t1.SORTABLE_ORDER, t2.SORTABLE_ORDER, t3.SORTABLE_ORDER) t
		LEFT JOIN t_da_category on (t.category_id = t_da_category.CATEGORY_ID)
		left join t_da_product on (t.product_id = t_da_product.PRODUCT_ID)
		left JOIN t_da_brand on (t.brand_id = t_da_brand.BRAND_ID)
		<dynamic prepend=" where t_da_product.DISPLAY_TYPE in ">
			<iterate open="(" close=")" conjunction=","> #[]# </iterate>
		</dynamic>
	</select>
	
</sqlMap>